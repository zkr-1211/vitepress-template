# Git使用规范说明



|    时间    |                    说明                    | 修改人 | 版本号 |
| :--------: | :----------------------------------------: | :----: | :----: |
| 2022-09-28 |             Git使用规范  初稿              | 龚循建 | v0.1.0 |
| 2022-09-30 |            添加操作说明和时序图            | 龚循建 | v0.3.0 |
| 2022-10-08 |        定稿，调整部分说明及错误描述        | 龚循建 | v1.0.0 |
| 2023-03-06 |        调整分支定义，删除版本号管理        | 龚循建 | v1.1.0 |
| 2023-05-20 |      精简操作流程，删除子任务相关操作      | 龚循建 | v1.1.1 |
| 2023-07-18 | 新增研发分支定义，重新添加复杂需求管理规定 | 龚循建 | v1.2.0 |



## Git使用规范的意义

​		实际开发过程中，多名程序员开发同一个项目时很容易造成代码混乱甚至代码丢失的情况，为解决分支和杂乱无章的问题，引入 Gitflow 代码开发合并管理办法，提出驿汇客 Git 使用规范。

​		旨在提升团队运作效率，降低组员沟通成本，提高团队运作效率。



## 一、版本规范



### ~~1）版本号定义~~

~~版本号使用 ***x.y.z*** 进行定义，例如：v1.3.1，v3.0.7~~

- ~~***x***：表示重大版本迭代，在项目业务出现重大更新时执行变更，比如：核心业务变化、框架深度重构、UI风格全量调优或置换等，此编号的变化由项管决定；~~
- ~~***y***：表示需求包迭代，正常情况下会按照版本包次序递增，遵循一包一码的原则，此编号的变化由产品经理决定；~~
- ~~***z***：表示禅道需求迭代，目前按照项目投产次数累加（可以多禅道合并投产），若遇x、y变更，z重置为1并重新参与禅道需求迭代；~~
- ~~a：表示Bug修正，按Bug修复个数依次累加，主版本号变更时重置，此项由研发自行（待确定）；~~

> 经组内协商，删除有关分支版本号的规定，后续版本分支的定义和命名均使用关键字、日期、禅道编号、内容描述等进行表述；
>
> 若后续启用版本号定义，届时会重新定制版本号规则，请知悉。



### 2）分支定义

- master：主分支，稳定版本，用于生产代码 **审查** 操作，需求包投产完结之后，一般由 **发布分支** 合并，合并过程会伴随代码审查，非特殊情况，不允许直接在 master 分支上提交代码；
- release：发布分支，项目投产后，代码统一归并此分支，执行代码 **归档** 操作，一般由 **预发布分支** 和 **紧急修复分支** 合并，非特殊情况，不允许直接在 release 分支上修改代码；
- release\_[投产日期]-[投产描述]：预发布分支，由研发主管基于**发布分支**统一创建，项目 **投产** 前执行分支合并，一般由 **开发分支** 并入，投产验收后，研发主管执行代码回归操作；
- feature/test\_[提测日期]-[提测描述]：测试分支，由研发主管创建，基于当前生产在用的 **发布分支** 执行创建操作；
- develop/[禅道编号]-[禅道名称]：研发分支，由研发负责人创建，基于最新的 **测试分支** 执行创建操作；
- hotfix/[修复时间]-[修复描述]：热修复修复分支，由Bug负责人基于**发布分支**创建，用于应对需求投产验证后出现的Bug问题，投产验收后，Bug负责人将信息同步至研发主管，由主管执行代码回归；

> 烦请各位同学严格按照上述分支定义执行命名分支



### 3）环境标识定义

各项目中涉及到环境隔离，无论文件命名或参数定义等，统一使用以下标识符

- local：本地环境标识
- dev：研发环境标识
- test：测试环境标识
- pre：预发布环境标识
- prod：生产环境标识



## 二、开发流程



### 1） 基本操作命令

​	0️⃣ 代码同步

​				`git pull xxx`

​	1️⃣ 创建需求

​				`git flow feature start xxx`

​	2️⃣ 完成需求

​				`git flow feature finish xxx`

​	3️⃣ 需求提测

​				`git push origin test_xxx`

​	4️⃣ 需求发布

​				`git push origin release_xxx`

​	5️⃣ 创建修复分支

​				`git hotfix origin release`



### 2） 操作时序图

​			[Git使用规范时序图](https://www.processon.com/view/link/63358dd363768977e8a66997)



### 3）  流程说明

#### 2.1 版本确立

​		项目经理完成需求评审，根据产品提供的优先级排序确认需求研发路径和投产计划，评审过程给出具体的投产线路、周上线计划；

#### 2.2 需求研发

​		研发阶段，研发人员自行创建任务分支，研发过程中尽量做到每日一提交并push至服务器上，确保提交代码不影响正常启动，避免因极端情况导致代码损失；

#### 2.3 测试验证

​		开发人员需求研发完成后且自测通过，报备至项目经理，由项目经理发起送测流程，统一部署至测试环境并通知相关测试人员测试；

#### 2.4 预发布准备

​		测试完成后，测试人员通知产品经理，在投产前夕，项目经理创建预发布分支，研发人员将投产所需的任务分支同步至预发布分支，最后统一部署至预发布环境，通知相关人员进行测试；

#### 2.5 预发布验证

​		测试人员在准生产环境验证，若验证出现Bug，研发人员介入确认是代码问题，则重复执行【2.3】【2.4】【2.5】，直至验证通过，将结果报备至产品经理，并重新确认投产发布时间；

#### 2.6 投产发布

​		研发在投产发布前，准备好投产需要的SQL语句和DBA审批材料、Nacos配置，需求负责的研发人员进编写投产操作执行shell脚本，投产操作执行完成后，通知测试人员执行生产验证；

#### 2.7 代码归档

​		投产后隔日，在确认生产验证通过后，由研发主管将预发布分支代码合并至发布分支中，完成后在群上发布通知，其他研发人员根据群上通知，及时把预发布分支的代码及时同步至 release 中；

#### 2.8 紧急修复

​		若有反馈功能缺陷或者Bug，确认与代码相关后，研发人员自行在当前发布分支上创建紧急修复分支；

#### 2.9 修复验证

​		研发人员本地验证完成后，直接投放准生产环境，通知测试人员进行验证直至验证通过，结果告知项目经理，执行生产功能修复，生产验证通过后，组长将紧急修复分支同步至发布分支；



## 三、提测&投产



### 1）联调

​		正常情况下，前端联调使用109研发环境，或者直连后端研发的本地环境进行接口联调；

### 2）提测

​		研发人员完成研发任务，将代码合并至测试分支，本地自测通过后，更新至108环境，更新前需在场景大群里通知产品和测试；

### 3）投产

1.  需求评审完成，研发侧2天内向产品侧提供需求研发用时和排期，根据需求优先级提供提测时间和投产计划；
2.  投产最小粒度为禅道，研发完成后向项目经理进行报备，投产前需向产品经理报备并确认投产时间；
3.  若投产过程中遇到异常，若能及时处理则申请权限自行操作；若短时间内无法解决，则执行版本回退，并报备至项目经理；

> 注意：投产最小粒度不是任务，是禅道，且可以多禅道合并投产。



## 附录



### 附录一、Git Flow 分支管理



​		参考 [一文读懂Gitflow分支管理](https://blog.csdn.net/m0_57479969/article/details/121564116)，文章仅供参考

